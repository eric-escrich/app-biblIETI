<div class="headerContainer flex flex-col items-center justify-center text-center">
    <header class="w-4/5">
        <div class="flex flex-col items-center justify-center ">
            <a [routerLink]="['/inici']"><h1>BIBLIOTECA MARI CARMEN BRITO</h1></a>
        </div>
    </header>
</div>

<div class="panelAcordeon">
    <form [formGroup]="configuracionAcordeon" (ngSubmit)="sendconfiguracionAcordeon()" class="flex flex-row gap-4 justify-center">
        <div class="w-3/4">
            <p-panel formGroupName="cercaAvancadaAcordeon" [collapsed]="panels['cercaAvancadaAcordeon']" (collapsedChange)="detectPanelChanges($event, 'cercaAvancadaAcordeon')" [toggleable]="true" expandIcon="pi pi-chevron-up" collapseIcon="pi pi-chevron-down">
                <ng-template pTemplate="header">
                    <div class="header-menu flex flex-row gap-2">
                        <span class="font-bold">Cerca avançada</span>
                    </div>
                </ng-template>

                <form>
                    <div class="flex flex-col items-center justify-start gap-x-20 w-full">    
                        <div class="grid grid-cols-3 gap-4 items-end">
                            <div class="flex flex-col items-start">
                                <label for="inputTitol">Títol</label>
                                <p-autoComplete
                                    [(ngModel)]="searchQuery"
                                    name="searchQuery"
                                    [suggestions]="items"
                                    (input)="onFilterChange()"
                                    [minLength]="3"
                                    field="name"
                                    (onSelect)="onItemSelect($event)"
                                ></p-autoComplete>
                            </div>

                            <div class="flex flex-col items-start">
                                <label for="tipoItem">Tipus d'item</label>
                                <p-dropdown 
                                    [options]="typesItemsArray" 
                                    [(ngModel)]="typeItem" 
                                    name="typeItem"
                                    optionLabel="name" 
                                    placeholder="Tipus d'item" />
                            </div>

                            <div class="flex flex-col items-start">
                                <label for="tipoItem">Estat</label>
                                <p-dropdown 
                                    [options]="statusArray" 
                                    [(ngModel)]="status" 
                                    name="status"
                                    optionLabel="name" 
                                    placeholder="Estat" />
                            </div>

                            <div class="flex flex-col items-start">
                                <label for="tipoItem">Centre</label>
                                <p-dropdown 
                                [options]="centersArray" 
                                [(ngModel)]="center" 
                                name="center"
                                optionLabel="label" 
                                placeholder="Centre"/>
                            </div>
                            <div class="w-full flex gap-6">
                                <div>
                                    <label for="date">Data de publicació (menor)</label>
                                    <p-calendar [(ngModel)]="publishDateMin" name="publishDateMin" id="publishDateMin" [style]="{ width: '100%' }"></p-calendar>
                                </div>
    
                                <div>
                                    <label for="date">Data de publicació (major)</label>
                                    <p-calendar [(ngModel)]="publishDateMax" name="publishDateMax" id="publishDateMax" [style]="{ width: '100%' }"></p-calendar>
                                </div>
                            </div>

                            @if (typeItem && typeItem.value == 'llibre') {
                                <div class="flex flex-col items-start">
                                    <label for="tipoItem">Editorial</label>
                                    <p-dropdown 
                                        [options]="publisherArray" 
                                        [(ngModel)]="publisher"
                                        name="publisher"
                                        optionLabel="label" 
                                        placeholder="Editorial"/>
                                </div>
    
                                <div class="flex flex-col items-start">
                                    <label for="tipoItem">Idioma</label>
                                    <p-dropdown 
                                        [options]="languagesArray" 
                                        [(ngModel)]="language"
                                        name="language"
                                        optionLabel="name" 
                                        placeholder="Idioma"/>
                                </div>
                            }

                            <p-button (click)="advancedSearch()" class="w-full" severity="fill-rounded" [style]="{ width: '100%' }">Guardar</p-button>

                        </div>
                    </div>
                </form>
            </p-panel>
        </div>
    </form>
</div>

@if (items) {
    <div class="searchContainer">
        <div class="grid grid-cols-3 px-10 mb-40 justify-center gap-x-20">
            <div
                class="cards w-64 h-[30rem]"
                [class.justify-center]="item.item_type != 'Book'"
                *ngFor="let item of currentItems"
                (click)="onSelectItem(item)"
            >
                @if (item.item_type == 'Book') {
                    <img class="bookCard" [src]="item.image" alt="Imatge de la portada del llibre">
                    <div class="details">
                        <p class="title m-0 text-center">{{item.title}}</p>
                        <p class="m-0 text-center">Escriptor: {{item.author}}</p>
                        <p class="m-0 text-center">CDU: {{item.CDU}}</p>
                        <p class="m-0 text-center">Exemplars disponibles: {{item.available_copies}}</p>
                    </div>
                } @else if (item.item_type == 'CD') {
                    <img class="cdCard" [src]="item.image" alt="Imatge de la portada del CD">
                    <div class="details">
                        <p class="title m-0 text-center">{{item.title}}</p>
                        <p class="m-0 text-center">Artista: {{item.author}}</p>
                        <p class="m-0 text-center">Discografia: {{item.discography}}</p>
                        <p class="m-0 text-center">Estil: {{item.style}}</p>
                        <p class="m-0 text-center">Exemplars disponibles: {{item.available_copies}}</p>
                    </div>
                }
            </div>
        </div>
    </div>
    <div class="flex items-center justify-center">
        <p-paginator
            (onPageChange)="onPageChange($event)"
            [first]="first"
            [rows]="rows"
            [totalRecords]="items.length"
            [showFirstLastIcon]="false" 
            [showCurrentPageReport]="true"
            currentPageReportTemplate="{first} - {last} de {totalRecords}"
            [rowsPerPageOptions]="[10, 25, 35, 50, 75, 100, 120]"
        ></p-paginator>
    </div>
}